<!-- Dashboard Premium -->
<ion-header class="ion-no-border">
  <ion-toolbar color="tertiary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Header com Gradiente -->
  <div class="hero-section">
    <div class="hero-glow"></div>
    <h1 class="hero-greeting">{{ greeting }}</h1>
    <p class="hero-date">{{ currentDate | date:'EEEE, d MMMM':'':'pt' }}</p>
    
    <!-- Weather Widget -->
    <div class="weather-widget" *ngIf="weather && !weatherLoading">
      <ion-icon [name]="getWeatherIconName(weather.icon)"></ion-icon>
      <div class="weather-info">
        <span class="weather-temp">{{ weather.temperature }}°C</span>
        <span class="weather-condition">{{ weather.condition }}</span>
      </div>
    </div>
    <div class="weather-widget loading" *ngIf="weatherLoading">
      <ion-spinner name="crescent"></ion-spinner>
      <span>Carregando clima...</span>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-number">{{ totalTasks }}</div>
      <div class="stat-label">Total</div>
    </div>
    <div class="stat-card highlight">
      <div class="stat-number">{{ completedTasks }}</div>
      <div class="stat-label">Feitas</div>
    </div>
    <div class="stat-card" [class.danger]="overdueTasks.length > 0">
      <div class="stat-number">{{ overdueTasks.length }}</div>
      <div class="stat-label">Atraso</div>
    </div>
  </div>

  <!-- Progress Ring -->
  <div class="progress-section" *ngIf="totalTasks > 0">
    <div class="progress-ring">
      <svg viewBox="0 0 100 100">
        <circle class="progress-bg" cx="50" cy="50" r="40"/>
        <circle class="progress-fill" cx="50" cy="50" r="40"
                [style.strokeDasharray]="251.2"
                [style.strokeDashoffset]="251.2 - (251.2 * progressPercent / 100)"/>
      </svg>
      <div class="progress-text">
        <span class="progress-value">{{ progressPercent }}%</span>
        <span class="progress-label">completo</span>
      </div>
    </div>
  </div>

  <!-- Overdue Alert -->
  <div class="alert-card danger" *ngIf="overdueTasks.length > 0">
    <div class="alert-icon">
      <ion-icon name="alert-circle"></ion-icon>
    </div>
    <div class="alert-content">
      <span class="alert-title">{{ overdueTasks.length }} em atraso</span>
      <span class="alert-subtitle">Requer atenção</span>
    </div>
    <ion-icon name="chevron-forward"></ion-icon>
  </div>

  <!-- Upcoming Tasks -->
  <div class="section" *ngIf="upcomingTasks.length > 0">
    <h2 class="section-title">Próximas Tarefas</h2>
    
    <div class="tasks-container">
      <div class="task-card" *ngFor="let task of upcomingTasks" (click)="goToTask(task.id)">
        <div class="task-date-badge" [class]="getPriorityColor(task.priority)">
          <span class="day">{{ task.dueDate | date:'d' }}</span>
          <span class="month">{{ task.dueDate | date:'MMM':'':'pt' }}</span>
        </div>
        <div class="task-details">
          <span class="task-name">{{ task.title }}</span>
          <span class="task-project">{{ getProjectName(task.projectId) }}</span>
        </div>
        <div class="task-priority" [class]="task.priority"></div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="totalTasks === 0">
    <div class="empty-icon">
      <ion-icon name="rocket-outline"></ion-icon>
    </div>
    <h3>Começa a tua jornada</h3>
    <p>Cria o teu primeiro projeto</p>
    <ion-button (click)="goToProjects()">
      <ion-icon slot="start" name="add"></ion-icon>
      Novo Projeto
    </ion-button>
  </div>

  <!-- All Done -->
  <div class="success-card" *ngIf="totalTasks > 0 && overdueTasks.length === 0 && upcomingTasks.length === 0">
    <div class="success-icon">✨</div>
    <h3>Tudo em dia!</h3>
    <p>Excelente trabalho</p>
  </div>

</ion-content>
