<!-- PÃ¡gina de Detalhes da Tarefa -->
<ion-header [translucent]="true">
  <ion-toolbar color="tertiary">
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="'/tabs/tasks'"></ion-back-button>
    </ion-buttons>
    <ion-title>Detalhes</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleEditMode()" *ngIf="!editMode">
        <ion-icon slot="icon-only" name="create-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="saveChanges()" *ngIf="editMode" color="light">
        <ion-icon slot="icon-only" name="checkmark-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="showOptions()">
        <ion-icon slot="icon-only" name="ellipsis-vertical"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="task-detail-content" *ngIf="task">

  <!-- Card de Status -->
  <div class="status-banner" [class.completed]="task.completed" [class.overdue]="isOverdue()">
    <div class="status-content">
      <div class="status-icon">
        <ion-icon [name]="task.completed ? 'checkmark-circle' : (isOverdue() ? 'alert-circle' : 'hourglass-outline')"></ion-icon>
      </div>
      <div class="status-text">
        <span class="status-label">{{ task.completed ? 'ConcluÃ­da' : (isOverdue() ? 'Em Atraso' : 'Pendente') }}</span>
        <span class="status-date" *ngIf="!task.completed">
          {{ isOverdue() ? 'Venceu em' : 'Vence em' }} {{ task.dueDate | date:'dd/MM/yyyy' }}
        </span>
      </div>
    </div>
    <ion-button fill="outline" size="small" (click)="toggleComplete()" class="status-btn">
      {{ task.completed ? 'Reabrir' : 'Concluir' }}
    </ion-button>
  </div>

  <!-- Modo de EdiÃ§Ã£o -->
  <div class="edit-form" *ngIf="editMode">
    <div class="form-card">
      <div class="form-header">
        <ion-icon name="create-outline"></ion-icon>
        <h2>Editar Tarefa</h2>
      </div>
      
      <div class="form-group">
        <label>TÃ­tulo</label>
        <ion-input [(ngModel)]="formData.title" placeholder="TÃ­tulo da tarefa"></ion-input>
      </div>
      
      <div class="form-group">
        <label>DescriÃ§Ã£o</label>
        <ion-textarea [(ngModel)]="formData.description" placeholder="DescriÃ§Ã£o (opcional)" rows="3"></ion-textarea>
      </div>
      
      <div class="form-group">
        <label>Data Limite</label>
        <ion-datetime-button datetime="datetime"></ion-datetime-button>
        <ion-modal [keepContentsMounted]="true">
          <ng-template>
            <ion-datetime 
              id="datetime" 
              [(ngModel)]="formData.dueDate"
              presentation="date"
              locale="pt-PT">
            </ion-datetime>
          </ng-template>
        </ion-modal>
      </div>
      
      <div class="form-group">
        <label>Prioridade</label>
        <ion-segment [(ngModel)]="formData.priority">
          <ion-segment-button value="low">
            <ion-label>ðŸŸ¢ Baixa</ion-label>
          </ion-segment-button>
          <ion-segment-button value="medium">
            <ion-label>ðŸŸ¡ MÃ©dia</ion-label>
          </ion-segment-button>
          <ion-segment-button value="high">
            <ion-label>ðŸ”´ Alta</ion-label>
          </ion-segment-button>
        </ion-segment>
      </div>
      
      <div class="form-actions">
        <ion-button fill="outline" (click)="toggleEditMode()">
          <ion-icon slot="start" name="close-outline"></ion-icon>
          Cancelar
        </ion-button>
        <ion-button (click)="saveChanges()">
          <ion-icon slot="start" name="checkmark-outline"></ion-icon>
          Guardar
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Modo de VisualizaÃ§Ã£o -->
  <div class="view-mode" *ngIf="!editMode">
    
    <!-- TÃ­tulo e Projeto -->
    <div class="main-info-card">
      <h1>{{ task.title }}</h1>
      <div class="project-tag" *ngIf="project">
        <ion-icon name="folder-outline"></ion-icon>
        <span>{{ project.name }}</span>
      </div>
      <p class="description" *ngIf="task.description">{{ task.description }}</p>
      <p class="no-description" *ngIf="!task.description">Sem descriÃ§Ã£o</p>
    </div>

    <!-- InformaÃ§Ãµes -->
    <div class="info-card">
      <div class="info-header">
        <ion-icon name="information-circle-outline"></ion-icon>
        <h2>InformaÃ§Ãµes</h2>
      </div>
      <div class="info-list">
        <div class="info-item">
          <div class="info-icon" [class.danger]="isOverdue()">
            <ion-icon name="calendar-outline"></ion-icon>
          </div>
          <div class="info-content">
            <span class="info-label">Data Limite</span>
            <span class="info-value" [class.danger]="isOverdue()">{{ task.dueDate | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
        <div class="info-item">
          <div class="info-icon">
            <ion-icon name="flag-outline"></ion-icon>
          </div>
          <div class="info-content">
            <span class="info-label">Prioridade</span>
            <ion-badge [color]="getPriorityColor()">{{ getPriorityText() }}</ion-badge>
          </div>
        </div>
      </div>
    </div>

    <!-- Imagem -->
    <div class="image-card">
      <div class="image-header">
        <ion-icon name="image-outline"></ion-icon>
        <h2>Imagem</h2>
      </div>
      <div class="image-content" *ngIf="task.imageUrl">
        <img [src]="task.imageUrl" alt="Imagem da tarefa">
        <div class="image-actions">
          <ion-button fill="outline" size="small" (click)="showImageOptions()">
            <ion-icon slot="start" name="camera-outline"></ion-icon>
            Alterar
          </ion-button>
          <ion-button fill="outline" size="small" color="danger" (click)="removeImage()">
            <ion-icon slot="start" name="trash-outline"></ion-icon>
            Remover
          </ion-button>
        </div>
      </div>
      <div class="no-image" *ngIf="!task.imageUrl">
        <div class="no-image-icon">
          <ion-icon name="camera-outline"></ion-icon>
        </div>
        <p>Sem imagem associada</p>
        <ion-button fill="outline" (click)="showImageOptions()">
          <ion-icon slot="start" name="add-outline"></ion-icon>
          Adicionar Imagem
        </ion-button>
      </div>
    </div>
    
  </div>

</ion-content>
