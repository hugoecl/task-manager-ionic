<!-- PÃ¡gina de Detalhes da Tarefa -->
<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="'/tasks/' + task?.projectId"></ion-back-button>
    </ion-buttons>
    <ion-title>Detalhes</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleEditMode()" *ngIf="!editMode">
        <ion-icon slot="icon-only" name="create-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="saveChanges()" *ngIf="editMode" color="success">
        <ion-icon slot="icon-only" name="checkmark-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="showOptions()">
        <ion-icon slot="icon-only" name="ellipsis-vertical"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" *ngIf="task">
  <!-- Card de Status -->
  <ion-card class="status-card" [class.completed]="task.completed" [class.overdue]="isOverdue()">
    <ion-card-content>
      <div class="status-row">
        <div class="status-info">
          <ion-icon [name]="task.completed ? 'checkmark-circle' : (isOverdue() ? 'alert-circle' : 'ellipse-outline')"></ion-icon>
          <span>{{ task.completed ? 'ConcluÃ­da' : (isOverdue() ? 'Em Atraso' : 'Pendente') }}</span>
        </div>
        <ion-button fill="outline" size="small" (click)="toggleComplete()">
          {{ task.completed ? 'Reabrir' : 'Concluir' }}
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- FormulÃ¡rio de EdiÃ§Ã£o -->
  <ion-card *ngIf="editMode">
    <ion-card-header>
      <ion-card-title>Editar Tarefa</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="stacked">TÃ­tulo</ion-label>
        <ion-input [(ngModel)]="formData.title" placeholder="TÃ­tulo da tarefa"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">DescriÃ§Ã£o</ion-label>
        <ion-textarea [(ngModel)]="formData.description" placeholder="DescriÃ§Ã£o (opcional)" rows="3"></ion-textarea>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Data Limite</ion-label>
        <ion-datetime-button datetime="datetime"></ion-datetime-button>
        <ion-modal [keepContentsMounted]="true">
          <ng-template>
            <ion-datetime 
              id="datetime" 
              [(ngModel)]="formData.dueDate"
              presentation="date"
              [preferWheel]="true">
            </ion-datetime>
          </ng-template>
        </ion-modal>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Prioridade</ion-label>
        <ion-select [(ngModel)]="formData.priority" interface="action-sheet">
          <ion-select-option value="high">ðŸ”´ Alta</ion-select-option>
          <ion-select-option value="medium">ðŸŸ¡ MÃ©dia</ion-select-option>
          <ion-select-option value="low">ðŸŸ¢ Baixa</ion-select-option>
        </ion-select>
      </ion-item>

      <div class="form-actions">
        <ion-button fill="outline" (click)="toggleEditMode()">Cancelar</ion-button>
        <ion-button (click)="saveChanges()">Guardar</ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- VisualizaÃ§Ã£o de Detalhes -->
  <div *ngIf="!editMode">
    <!-- TÃ­tulo e DescriÃ§Ã£o -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ task.title }}</ion-card-title>
        <ion-card-subtitle *ngIf="project">
          <ion-icon name="folder-outline"></ion-icon>
          {{ project.name }}
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content *ngIf="task.description">
        <p>{{ task.description }}</p>
      </ion-card-content>
    </ion-card>

    <!-- InformaÃ§Ãµes -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="information-circle-outline"></ion-icon>
          InformaÃ§Ãµes
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <!-- Data Limite -->
          <ion-item>
            <ion-icon slot="start" name="calendar-outline" [color]="isOverdue() ? 'danger' : 'primary'"></ion-icon>
            <ion-label>
              <p>Data Limite</p>
              <h3 [class.overdue]="isOverdue()">{{ task.dueDate | date:'EEEE, dd MMMM yyyy':'':'pt' }}</h3>
            </ion-label>
          </ion-item>

          <!-- Prioridade -->
          <ion-item>
            <ion-icon slot="start" name="flag-outline" [color]="getPriorityColor()"></ion-icon>
            <ion-label>
              <p>Prioridade</p>
              <h3>
                <ion-badge [color]="getPriorityColor()">{{ getPriorityText() }}</ion-badge>
              </h3>
            </ion-label>
          </ion-item>

          <!-- Data de CriaÃ§Ã£o -->
          <ion-item>
            <ion-icon slot="start" name="time-outline" color="medium"></ion-icon>
            <ion-label>
              <p>Criada em</p>
              <h3>{{ task.createdAt | date:'dd/MM/yyyy HH:mm' }}</h3>
            </ion-label>
          </ion-item>

          <!-- Ãšltima AtualizaÃ§Ã£o -->
          <ion-item>
            <ion-icon slot="start" name="refresh-outline" color="medium"></ion-icon>
            <ion-label>
              <p>Ãšltima atualizaÃ§Ã£o</p>
              <h3>{{ task.updatedAt | date:'dd/MM/yyyy HH:mm' }}</h3>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Imagem -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="image-outline"></ion-icon>
          Imagem
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <!-- Se tem imagem, mostra -->
        <div *ngIf="task.imageUrl" class="image-container">
          <img [src]="task.imageUrl" alt="Imagem da tarefa" class="task-image">
          <div class="image-actions">
            <ion-button fill="outline" size="small" (click)="showImageOptions()">
              <ion-icon slot="start" name="camera-outline"></ion-icon>
              Alterar
            </ion-button>
            <ion-button fill="outline" size="small" color="danger" (click)="removeImage()">
              <ion-icon slot="start" name="trash-outline"></ion-icon>
              Remover
            </ion-button>
          </div>
        </div>
        
        <!-- Se nÃ£o tem imagem, mostra botÃ£o para adicionar -->
        <div *ngIf="!task.imageUrl" class="no-image">
          <ion-icon name="camera-outline"></ion-icon>
          <p>Sem imagem anexada</p>
          <ion-button fill="outline" (click)="showImageOptions()">
            <ion-icon slot="start" name="add-outline"></ion-icon>
            Adicionar Imagem
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
