<!-- Tarefas Premium -->
<ion-header class="ion-no-border">
  <ion-toolbar color="tertiary">
    <ion-buttons slot="start">
      <ion-back-button *ngIf="!isTabMode" defaultHref="/tabs/projects" text=""></ion-back-button>
      <ion-menu-button *ngIf="isTabMode"></ion-menu-button>
    </ion-buttons>
    <ion-title>{{ isTabMode ? 'Tarefas' : project?.name }}</ion-title>
    <ion-buttons slot="end" *ngIf="!isTabMode && projectId">
      <ion-button (click)="toggleReorder()">
        <ion-icon [name]="reorderEnabled ? 'checkmark' : 'swap-vertical'"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Filtros -->
  <div class="filters-section" *ngIf="isTabMode">
    <ion-segment [(ngModel)]="filter" (ionChange)="applyFilter()">
      <ion-segment-button value="all">Todas</ion-segment-button>
      <ion-segment-button value="pending">Pendentes</ion-segment-button>
      <ion-segment-button value="overdue">Atraso</ion-segment-button>
      <ion-segment-button value="completed">Feitas</ion-segment-button>
    </ion-segment>
  </div>

  <!-- Counter -->
  <div class="counter">
    <span class="count">{{ filteredTasks.length }}</span>
    <span class="label">tarefa(s)</span>
  </div>

  <!-- Tasks List -->
  <ion-list *ngIf="filteredTasks.length > 0" lines="none">
    <ion-reorder-group [disabled]="!reorderEnabled" (ionItemReorder)="handleReorder($event)">
      <ion-item-sliding *ngFor="let task of filteredTasks">
        <ion-item 
          [class.completed]="task.completed"
          [class.overdue]="isOverdue(task)"
          [button]="!reorderEnabled"
          (click)="!reorderEnabled && goToTaskDetail(task.id)">
          
          <!-- Reorder Handle -->
          <ion-reorder slot="start" *ngIf="reorderEnabled"></ion-reorder>
          
          <!-- Checkbox -->
          <div class="checkbox-area" slot="start" *ngIf="!reorderEnabled" (click)="toggleComplete(task); $event.stopPropagation()">
            <div class="custom-check" [class.checked]="task.completed">
              <ion-icon name="checkmark" *ngIf="task.completed"></ion-icon>
            </div>
          </div>
          
          <!-- Content -->
          <div class="task-content">
            <span class="task-title" [class.done]="task.completed">{{ task.title }}</span>
            <div class="task-meta">
              <span class="project" *ngIf="isTabMode">{{ getProjectName(task.projectId) }}</span>
              <span class="date" [class.late]="isOverdue(task)">{{ task.dueDate | date:'d MMM':'':'pt' }}</span>
              <span class="tag today" *ngIf="isDueToday(task)">Hoje</span>
              <span class="tag overdue" *ngIf="isOverdue(task)">Atrasada</span>
            </div>
          </div>
          
          <!-- Priority Indicator -->
          <div class="priority-glow" slot="end" [class]="task.priority"></div>
        </ion-item>
        
        <!-- Sliding Options -->
        <ion-item-options side="end" *ngIf="!reorderEnabled">
          <ion-item-option color="primary" (click)="goToTaskDetail(task.id)">
            <ion-icon slot="icon-only" name="create-outline"></ion-icon>
          </ion-item-option>
          <ion-item-option color="danger" (click)="deleteTask(task, $event)">
            <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-reorder-group>
  </ion-list>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="filteredTasks.length === 0">
    <div class="empty-icon">
      <ion-icon name="checkbox-outline"></ion-icon>
    </div>
    <h3 *ngIf="filter === 'all'">Sem tarefas</h3>
    <h3 *ngIf="filter === 'pending'">Nenhuma pendente</h3>
    <h3 *ngIf="filter === 'overdue'">Nenhuma em atraso</h3>
    <h3 *ngIf="filter === 'completed'">Nenhuma concluÃ­da</h3>
    <p *ngIf="filter === 'overdue'">EstÃ¡s em dia! ğŸ‰</p>
  </div>

  <!-- FAB -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="addTask()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
